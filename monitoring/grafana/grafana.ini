# =============================================================================
# Grafana Configuration for Legal AI System
# =============================================================================
# Production-ready configuration with security hardening,
# legal compliance features, and authentication integration
# =============================================================================

[default]
# Instance name and organization
instance_name = Legal AI System - Monitoring
default_org_name = Legal AI Organization

[server]
# Server configuration
protocol = http
http_addr = 0.0.0.0
http_port = 3000
domain = grafana.legal-ai.example.com
root_url = https://%(domain)s/

# Enable gzip compression
enable_gzip = true

# Static root path
static_root_path = public

# Logging
log_level = info

[database]
# Database configuration (PostgreSQL)
type = postgres
host = postgres.legal-ai-system.svc.cluster.local:5432
name = legal_ai_grafana
user = grafana_user
password = $__file{/etc/secrets/grafana-db-password}
ssl_mode = require
max_open_conn = 300
max_idle_conn = 300

[security]
# Security settings for legal environment
admin_user = admin
admin_password = $__file{/etc/secrets/grafana-admin-password}

# Disable user signup
allow_sign_up = false

# Password policy for legal compliance
password_min_length = 12
password_require_upper_case = true
password_require_lower_case = true
password_require_number = true
password_require_symbol = true

# Cookie security
cookie_secure = true
cookie_samesite = strict
login_cookie_name = legal_ai_grafana_session

# CSRF protection
disable_gravatar = true
data_source_proxy_whitelist = prometheus.legal-ai-system.svc.cluster.local:9090

# Content security policy
content_type_protection_header = true
x_content_type_options = nosniff
x_xss_protection = true
strict_transport_security = true

[auth]
# Authentication settings
disable_login_form = false
disable_signout_menu = false
oauth_auto_login = false

# Session timeout for legal compliance
login_maximum_inactive_lifetime_duration = 8h
login_maximum_lifetime_duration = 24h

[auth.oauth_generic]
# OAuth integration (if using external auth)
enabled = false
allow_sign_up = false
auto_login = false
role_attribute_path = contains(roles[*], 'legal-ai-admin') && 'Admin' || contains(roles[*], 'legal-ai-editor') && 'Editor' || 'Viewer'

[rbac]
# Role-based access control
permission_cache = true

[users]
# User management
allow_sign_up = false
allow_org_create = false
auto_assign_org = true
auto_assign_org_role = Viewer
verify_email_enabled = false

# Default user permissions
viewers_can_edit = false
editors_can_admin = false

[org]
# Organization settings
role = Viewer

[dashboards]
# Dashboard settings
default_home_dashboard_path = /var/lib/grafana/dashboards/legal-ai-overview.json
min_refresh_interval = 5s

[explore]
# Explore feature (for debugging)
enabled = true

[alerting]
# Alerting configuration
enabled = true
execute_alerts = true
max_attempts = 3
min_interval_seconds = 10

[unified_alerting]
# Unified alerting (Grafana 8+)
enabled = true
disabled_orgs = 
min_interval = 10s
max_interval = 60s

# Alert rule evaluation
evaluate_timeout = 30s
max_annotation_length = 65536
max_annotations = 10

[smtp]
# Email configuration for alerts
enabled = true
host = smtp.legal-ai.example.com:587
user = grafana@legal-ai.example.com
password = $__file{/etc/secrets/smtp-password}
skip_verify = false
from_address = grafana@legal-ai.example.com
from_name = Legal AI Grafana
ehlo_identity = grafana.legal-ai.example.com
startTLS_policy = MandatoryStartTLS

[log]
# Logging configuration
mode = console, file
level = info
format = console

[log.console]
level = info
format = console

[log.file]
level = info
format = text
log_rotate = true
max_lines = 1000000
max_size_shift = 28
daily_rotate = true
max_days = 7

[metrics]
# Prometheus metrics for Grafana itself
enabled = true
disable_total_stats = false
basic_auth_username = legal-ai-monitoring
basic_auth_password = $__file{/etc/secrets/metrics-password}

[tracing.jaeger]
# Distributed tracing (optional)
address = jaeger-collector.legal-ai-system.svc.cluster.local:14268
always_included_tag = app=legal-ai-grafana

[feature_toggles]
# Feature flags
enable = publicDashboards
disable = 

[plugins]
# Plugin settings
allow_loading_unsigned_plugins = false
plugin_admin_enabled = true
plugin_catalog_url = https://grafana.com/api/plugins
plugin_admin_external_manage_enabled = true

[plugin.grafana-piechart-panel]
path = /var/lib/grafana/plugins/grafana-piechart-panel

[enterprise]
# Grafana Enterprise features (if licensed)
license_path = /etc/grafana/license.jwt

[panels]
# Panel settings
disable_sanitize_html = false
enable_alpha = false

[live]
# Grafana Live (real-time features)
max_connections = 100

[dataproxy]
# Data source proxy settings
timeout = 30
keep_alive_seconds = 30
tls_handshake_timeout_seconds = 10
expect_continue_timeout_seconds = 1
max_idle_connections = 100
max_idle_connections_per_host = 100

[analytics]
# Analytics and reporting
reporting_enabled = false
google_analytics_ua_id = 
google_tag_manager_id = 

[snapshots]
# Dashboard snapshots
external_enabled = false

[external_image_storage]
# External image storage for alerts
provider = local

[external_image_storage.local]
path = /var/lib/grafana/png

[rendering]
# Image rendering service
server_url = http://grafana-image-renderer.legal-ai-system.svc.cluster.local:8081/render
callback_url = http://grafana.legal-ai-system.svc.cluster.local:3000/

[date_formats]
# Date format settings
full_date = MMM Do, YYYY @ HH:mm:ss
interval_second = HH:mm:ss
interval_minute = HH:mm
interval_hour = MM/DD HH:mm
interval_day = MM/DD
interval_month = YYYY-MM
interval_year = YYYY
use_browser_locale = false
default_timezone = UTC